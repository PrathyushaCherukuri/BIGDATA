SQL: Structured Query Language

Database, Dataware house, OLAP,OLTP
Normalisation 
De-Normalisation
ER-diagram (Relationships)
Joins
    * Inner Join
    * Outer/Full outer Join
    * Left Outer Join
    * Right Outer Join
    * Self Join
    * Cross Join
    * Anti-left Join
    * Anti-right Join
Sub-Query
Co-related sub-Query
Window Functions
    -Aggregate Functions
        * SUM()
        * AVG()
        * COUNT()
        * MIN()
        * MAX()
    -Ranking Window Functions
        * RANK()
        * DENSE_RANK()
        * ROW_NUMBER()
        * PERCENT_RANK()
    -Value Window Functions
        * LAG()
        * LEAD()
        * FIRST_VALUE()
        * LAST_VALUE()
        * NTH_VALUE()
CTE - Common table Expression
Indexes
    - Clustered Indexes
    - Non-Clustered Indexes
SQL Merge Statement

Incremental Load : Copy data from db to datalake from the last load. 
Full Load : Copy all data from db to datalake

My Research Concepts:

SCD - Slowly Changing Dimensions
    SCD Type 0: Retain orginal (no changes allowed once created)
    SCD Type 1: Overwrite (no history kept, correcting errors)
    SCD Type 2: New row is inserted for every change (history is preserved)
    SCD Type 3: Add new attribute (Partial history, Store limited history by adding extra columns)
    SCD Type 4: History table(Changes recorded in separate history table)


UNION : Does not includes duplicates
UNION ALL : includes duplicates
Views : Do not stores data, runs original query each time
Materialized Views : Stores aggregated result physically.

CURSORS:
========
A cursor is a SQL mechanism that allows you to process rows one by one instead 
of all at once.
A cursor has 4 main steps:
-> DECLARE — define the cursor
-> OPEN — allocate memory and run SELECT
-> FETCH — get one row at a time
-> CLOSE — release memory

Implicit cursors:
----------------
Automatically created by SQL for simple statements.

Explicit Cursors:
---------------
You manually declare and control it.
Used when you must process rows individually.

Logical Cursors:
----------------
Static Cursor - Result set fixed at OPEN time
Dynamic Cursor- Changes reflect data changes while cursor is open
Forward-only Cursor - Can fetch only next row
Scrollable Cursor - Can go next, prior, first, last

SET OPERATIONS:
===============
UNION - Combine results, remove duplicates
UNION ALL - Combine results, keep duplicates
INTERSECT - Return only common rows (present in both queries)
MINUS (Oracle) / EXCEPT (SQL Server) - Return rows in first query that are not in second

Stored Procedures:
=================
A stored procedure is a precompiled SQL program stored in the database that can be 
executed multiple times to perform operations such as querying, updating, or managing data.
Advantages:
-----------
Perfromance
Code-resuability
Maintainability
Consistency

Ex:
CREATE PROCEDURE IncreaseSalaryByAmount
    @amount DECIMAL(10,2)  -- input parameter
AS
BEGIN
    UPDATE employees
    SET salary = salary + @amount;
END;

EXEC IncreaseSalaryByAmount 1000;

Referential Integrity:
=====================
Referential integrity is a database rule that ensures foreign keys in a child table 
always match primary keys in the parent table, preventing inconsistent or orphaned data.


composite key, candidate key, surrogate key
CASCADE:
=======
CASCADE is a rule used in database relationships that tells SQL what to 
do with child (dependent) rows or objects when you modify a parent.

-> ON DELETE CASCADE - Delete child when parent deleted
-> ON UPDATE CASCADE - Update child when parent updated
-> ON DELETE SET NULL - Set child FK to NULL
-> ON UPDATE SET NULL - Set child FK to NULL
-> ON DELETE SET DEFAULT - Set child to default value
-> ON UPDATE SET DEFAULT - Set child to default value
-> RESTRICT / NO ACTION - Prevent delete/update of parent
-> DROP … CASCADE - Drop object + all dependencies
-> DROP … RESTRICT - Prevent dropping if dependencies exist




COALESCE:
=========
SELECT COALESCE(middle_name, nickname, 'No Name') AS display_name
FROM users;
logic:
-----
If middle_name is NOT NULL → return it
Else try nickname
If both are NULL → return 'No Name'





Questions:

How many tables are created in M to M? why?
3 tables
A many-to-many relationship requires 3 tables: the two entity tables and one junction table.
This is because relational databases only support one-to-many relationships directly, so the junction table is needed to connect them.
Ex: Multiple employees working on multiple projects 

Can inner query execute independently?
Sub-query  – Yes
Co-related query – No

SQL 
1.Types of commands and their examples.
    DDL : CREATE, ALTER, DROP(delete table), TRUNCATE (Keeps structure, delete data)
    DML : INSERT, UPDATE, DELETE, MERGE
    DQL : SELECT
    DCL : GRANT, REVOKE
    TCL : COMMIT, ROLLBACK, SAVEPOINT, SET TRANSACTION

2.What is Normalization and denormalization? 
Normalisation: Involves dividing larger tables into smaller, related tables 
and defines the relationship between them.
    - Reduce data redundancy (duplicate data)
    - Improve data integrity

De-Normalisation: It involves combining tables or adding redudant data to
improve read performance.
    - Reduce number of Joins
    - Speed up heavy operations
    - Used in dataware houses or reporting system.

3.Explain 1NF, 2NF, 3NF.
1NF : Ensures each column has atomic value; no repeating groups.
2NF : Ensure all non-key columns are fully dependent on the primary key.
3NF : Ensure no transitive dependency (non-key column depends on another non-key column)
BCNF : Resolve certain anomalies not handled by 3NF.

4.Share use case where you had to do denormalization in database..
The business wanted a daily sales dashboard that showed metrics like:
    - Total sales per customer
    - Most purchased products
    - Total revenue per category
With normalization, generating these reports required multiple joins
across Orders, Order_Items, Products, and Customers. As the dataset 
grew to millions of orders, these queries became slow, especially for 
real-time dashboards.

5.What is primary key and foreign key?
Primary key : 
    - A column in a table that uniquely identifies each row.
    - It contain NULL values and must be unique.
Foreign key :
    - A foreign key is a column (or a set of columns) in one table that
 refers to the primary key in another table.
    - It is used to establish a relationship between two tables.

 6.what is alternate, candidate key & Business Key? 
Candidate Key :
    - A candidate key is a column (or a set of columns) in a table that
can uniquely identify each row.
    - A table can have one or more candidate keys.
    - Among candidate keys, one is chosen as the primary key. The rest are alternate keys.
Alternate Key :
    - An alternate key is a candidate key that was not chosen as the 
primary key.
    - It can still be used to uniquely identify rows, but it is not the main primary key.
Business Key :
    - A business key (sometimes called a natural key) is a key that has real-world meaning outside the database.
    - It is often used by the business to identify entities, not just for technical uniqueness.
Example:
In a Customers table: Email or SocialSecurityNumber could be a business key.
These have meaning in real life (email identifies the person, SSN identifies a citizen).
 
7.What are window functions?
A window function performs a calculation across a set of rows related to
the current row without collapsing the result into a single output row.

8.Explain Ranking Functions? Given a small table , write the output.
ROW_NUMBER() : series of numbers (1,2,3,4,....)
RANK() : Assigns a rank to rows with gaps for ties. (1,2,2,4,4,6,..)
DENSE_RANK() : Assigns a rank to rows without gaps for ties. (1,2,2,3,3,4...)
Ex:
SELECT Employee, Amount,
       ROW_NUMBER() OVER (ORDER BY Amount DESC) AS RowNum
FROM Sales;

9.Types of Joins? With example and usecase. All the number of records return and exact records.


10.	Use case when self join is required.

Self-joins are used in:
    -> Organizational charts
    -> Department hierarchies
    -> Reporting manager structures
    -> Folder–subfolder structures
    -> Category–subcategory in e-commerce
Manager–Employee Relationship:
Background:

In many companies, manager and employees are stored in the same table 
because managers are also employees.
So the table looks like:

Table: Employees

EmpID | EmpName | ManagerID
--------------------------------
1     | John    | 3
2     | Mary    | 3
3     | Sam     | NULL
4     | Rita    | 1


ManagerID refers to another EmpID in the same table.
This creates a hierarchical relationship (employee → manager).

⭐ Problem
------------
The HR team wants a report that shows:
Each employee
Their corresponding manager’s name
But the manager’s name is not directly stored—only the manager ID is.

⭐ Why Self Join is Needed
----------------------------
Both employees and managers are in the same table.
To connect them, the table must be joined to itself:
One copy represents employees
The other represents managers

Solution (Self Join)
======================
SELECT 
    e.EmpName AS Employee,
    m.EmpName AS Manager
FROM Employees e
LEFT JOIN Employees m
    ON e.ManagerID = m.EmpID;

Employee | Manager
-----------------------
John     | Sam
Mary     | Sam
Sam      | NULL
Rita     | John

Employees (e)    → acts as child
Employees (m)    → acts as parent/manager

11.	What is subquery?
Query inside another query is said to be subquery.
The outer query uses the result returned by the subquery.

12.	What is corelated subquery?
A correlated subquery is a subquery that depends on the outer query 
for its values.
It runs once for every row of the outer query.

13.	What is CTE? 
A CTE is a temporary, named result set that you create using the WITH
clause, and you can use it just like a table within your main SQL query.
It is not stored in the database,it's only available for the duration of that query.

14.	What is derived table?
A derived table is a subquery used in the FROM clause, and it acts like
a temporary table only for that query.
Ex : SELECT EmpName, Salary
        FROM (
            SELECT EmpName, Salary
            FROM Employees
            WHERE Salary > 5000
    ) AS HighSalaryEmployees;

15.	Find third highest employee based on salary?
USING LIMIT & OFFSET
---------------------
SELECT *
FROM employees
ORDER BY salary DESC
LIMIT 1 OFFSET 2;   -- 3rd highest

USING DENSE_RANK()
-------------------
SELECT *
FROM (
    SELECT *, DENSE_RANK() OVER (ORDER BY salary DESC) AS rnk
    FROM employees
) t
WHERE rnk = 3;

16.	Find third highest employee based on salary  per department?

SELECT department_id, employee_name, salary
FROM (
    SELECT 
        department_id,
        employee_name,
        salary,
        DENSE_RANK() OVER (
            PARTITION BY department_id 
            ORDER BY salary DESC
        ) AS rnk
    FROM employees
) t
WHERE rnk = 3;

17.	How to find duplicate values in a single column?

SELECT column_name, COUNT(*) AS count
FROM table_name
GROUP BY column_name
HAVING COUNT(*) > 1;

18.	How to find duplicate values in a multiple column?

SELECT *
FROM table_name
WHERE column_name IN (
    SELECT column_name
    FROM table_name
    GROUP BY column_name
    HAVING COUNT(*) > 1
);

19.	What are ACID properties?
A - Atomicity : All operations succeed or none.
C - Consistency : Database remains in a valid state.
I - Isolation : Preventing transactions from interfering with each other.
D - Durability : Comitted transactions must be permanent.

20.	Diff between union and union all
UNION : Does not includes duplicates
UNION ALL : includes duplicates

21.	Diff between primary key and unique key
Primary Key : Unique + NOT NULL, only one per table.
Unique Key : Unique, can have multiple per table, allows NULL.

22.	Diff between delete, truncate and drop?
DELETE  : Row-wise deletion, can rollback, triggers fire.
TRUNCATE : Removes all rows, faster, cannot rollback, no triggers
DROP : Removes table structure completely.

23.	Diff between having and where
WHERE : Filters rows before aggregation
HAVING : Filters rows after aggregation

24.	SQL query execution order.
FROM → Tables are identified and joined if multiple tables are involved.
WHERE → Filters rows before grouping.
GROUP BY → Groups rows based on specified columns.
HAVING → Filters groups after aggregation.
SELECT → Selects the columns or expressions to return.
DISTINCT → Removes duplicate rows from the result set (if specified).
ORDER BY → Sorts the final result.
LIMIT / OFFSET → Returns a subset of rows (if specified).

25.	What are indexes? Types of Indexes and their differences.
An index is a database object that improves the speed of data retrieval from a table

| Type                    | Description                                                                                    | Example Usage                             |
| ----------------------- | ---------------------------------------------------------------------------------------------- | ----------------------------------------- |
| **Primary Key Index**   | Automatically created on the primary key; ensures **uniqueness**.                              | `id` in `employees` table                 |
| **Unique Index**        | Ensures that indexed column(s) have **unique values**.                                         | `email` in `users` table                  |
| **Clustered Index**     | Stores the **actual table rows in sorted order** according to the index. Only **1 per table**. | `id` column in SQL Server or MySQL InnoDB |
| **Non-Clustered Index** | Stores **pointers to table rows**; can have **multiple per table**.                            | `last_name` for faster searches           |
| **Composite Index**     | Index on **multiple columns**; useful for queries involving multiple columns.                  | `(first_name, last_name)`                 |
| **Full-Text Index**     | Optimized for **text searching** (LIKE, CONTAINS) in large text columns.                       | `description` in `products` table         |
| **Bitmap Index**        | Uses **bits** to represent values; good for **low-cardinality columns** like gender or status. | `gender` in HR system                     |
| **Hash Index**          | Uses a **hash function** for fast equality searches; often in memory-optimized databases.      | Key-value lookups                         |


26.	Ways to optimize sql query?
- Using Proper indexing
- Avoid SELECT *
- Using WHERE clause effeciently
- Using joins instead of sub-queries
- Limit rows
- Avoid distinct if not needed
- Optimize ORDER BY and GROUP BY
- Use Query Execution Plan